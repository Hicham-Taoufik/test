<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      name="description"
      content="Dashboard de réception pour la gestion des patients - MediClinic"
    />
    <meta name="theme-color" content="#ffffff" />
    <title>Réception - MediClinic</title>
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <!-- Fonts and icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Select2 CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css"
      rel="stylesheet"
    />
    <!-- Local CSS -->
    <link rel="stylesheet" href="style.css" />
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Passer au contenu principal</a>
    <div class="container">
      <header class="header">
        <div class="header-main-content">
          <div class="logo">
            <img
              src="./clinique-nakhil-logo-horizontal.webp"
              alt="MediClinic Logo"
              class="logo-img"
              width="180"
              height="40"
            />
          </div>
          <h1 class="header-title">Réception</h1>
        </div>
        <div class="header-logout">
          <button
            type="button"
            class="btn btn-outline logout-btn no-print"
            aria-label="Déconnexion"
            id="logoutBtn"
          >
            <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Déconnexion
          </button>
        </div>
      </header>

      <main id="main-content" class="flex-row">
        <div class="flex-col">
          <!-- Create Patient Section -->
          <section class="card" aria-labelledby="create-patient-heading">
            <div class="card-header">
              <h2 id="create-patient-heading" class="card-title">
                <i class="fas fa-user-plus" aria-hidden="true"></i> Créer un Patient
              </h2>
              <div class="card-actions" aria-hidden="true">
                <i class="fas fa-pen"></i>
              </div>
            </div>
            <div class="card-body">
              <!-- ID Capture Section -->
              <div class="id-capture-section mb-4 no-print">
                <button
                  id="captureIdButton"
                  type="button"
                  class="btn btn-primary"
                >
                  <i class="fas fa-camera"></i> Scanner CIN
                </button>
                <div id="idCaptureContainer" class="hidden">
                  <p id="captureInstruction">
                    Positionnez le RECTO de la CIN et prenez la photo.
                  </p>
                  <video id="idVideo" playsinline></video>
                  <canvas id="idCanvas" class="hidden"></canvas>
                  <div class="d-flex justify-content-center gap-2 my-2">
                    <img
                      id="frontPreview"
                      class="capture-preview hidden"
                      alt="Aperçu Recto"
                    />
                    <img
                      id="backPreview"
                      class="capture-preview hidden"
                      alt="Aperçu Verso"
                    />
                  </div>
                  <div class="btn-group mt-2">
                    <button
                      id="takePhotoButton"
                      type="button"
                      class="btn btn-success"
                      disabled
                    >
                      <i class="fas fa-camera-retro"></i> Prendre Photo
                    </button>
                    <button
                      id="cancelCaptureButton"
                      type="button"
                      class="btn btn-secondary"
                      disabled
                    >
                      Annuler
                    </button>
                  </div>
                  <div
                    id="captureMessage"
                    class="message message-info mt-2"
                  ></div>
                </div>
              </div>
              <!-- END ID Capture Section -->

              <form id="createForm" novalidate>
                <div class="form-grid">
                  <div class="input-group">
                    <label for="nom">
                      Nom <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="nom"
                      name="nom"
                      type="text"
                      placeholder="Nom de famille"
                      required
                      aria-required="true"
                      autocomplete="family-name"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="prenom">
                      Prénom <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="prenom"
                      name="prenom"
                      type="text"
                      placeholder="Prénom"
                      required
                      aria-required="true"
                      autocomplete="given-name"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="cin">
                      CIN <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="cin"
                      name="cin"
                      type="text"
                      placeholder="Ex: AB123456"
                      required
                      aria-required="true"
                      pattern="^[A-Za-z]{1,2}\d{5,6}$"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="telephone">
                      Téléphone
                      <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="telephone"
                      name="telephone"
                      type="tel"
                      placeholder="Ex: 0612345678"
                      required
                      aria-required="true"
                      autocomplete="tel"
                      pattern="^0[5-7]\d{8}$"
                      inputmode="numeric"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="adresse">
                      Adresse <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="adresse"
                      name="adresse"
                      type="text"
                      placeholder="Adresse complète"
                      required
                      aria-required="true"
                      autocomplete="address-line1"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="ville">
                      Ville <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="ville"
                      name="ville"
                      type="text"
                      placeholder="Ville"
                      required
                      aria-required="true"
                      autocomplete="address-level2"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="date_naissance">
                      Date de Naissance
                      <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <input
                      id="date_naissance"
                      name="date_naissance"
                      type="date"
                      required
                      aria-required="true"
                      autocomplete="bday"
                    />
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <div class="input-group">
                    <label for="sexe">
                      Sexe <span class="required" aria-hidden="true">*</span>
                      <span class="sr-only">(obligatoire)</span>
                    </label>
                    <select
                      id="sexe"
                      name="sexe"
                      required
                      aria-required="true"
                      autocomplete="sex"
                    >
                      <option value="" disabled selected>Choisir...</option>
                      <option value="M">Homme</option>
                      <option value="F">Femme</option>
                    </select>
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <!-- Updated Mutuelle Dropdown -->
                  <div class="input-group mutuelle-group">
                    <label for="mutuelle">Mutuelle</label>
                    <select name="mutuelle" id="mutuelle" class="form-select">
                      <option value="" disabled selected>Choisir une mutuelle...</option>
                      <!-- Options populated by JS -->
                    </select>
                    <div class="error-text" aria-live="polite"></div>
                  </div>
                  <!-- Doctor Dropdown -->
                  <div class="input-group">
                    <label for="doctor">Médecin</label>
                    <select name="doctor" id="doctor" class="form-select">
                      <option value="" disabled selected>Choisir un médecin...</option>
                      <!-- Options populated by JS -->
                    </select>
                    <div class="error-text" aria-live="polite"></div>
                  </div>

                  <div class="form-submit-button">
                    <button
                      type="submit"
                      class="btn btn-success"
                      id="createPatientBtn"
                    >
                      <i class="fas fa-plus-circle" aria-hidden="true"></i>
                      Créer Patient & Démarrer Visite
                    </button>
                  </div>
                  <div
                    id="message"
                    class="message"
                    role="alert"
                    aria-live="polite"
                  ></div>
                </div>
              </form>
              <div id="createResult" class="hidden">
                <!-- We keep only the QR code image and the print buttons -->
                <div class="qr-code-container">
                  <img
                    id="createQrCodeImage"
                    src=""
                    alt="QR Code patient"
                    loading="lazy"
                  />
                </div>
                <!-- Existing print QR button (kept) -->
                <button
                  id="createPrintButton"
                  class="btn btn-secondary"
                  disabled
                >
                  <i class="fas fa-print" aria-hidden="true"></i> Imprimer QR Code
                </button>
                <!-- Print infos button for created patient (kept) -->
                <button id="createPrintInfoButton" class="btn btn-secondary" disabled>
                  <i class="fas fa-print" aria-hidden="true"></i> Imprimer Infos
                </button>
              </div>
            </div>
          </section>
        </div>

        <div class="flex-col">
          <!-- Search Patient Section -->
          <section class="card" aria-labelledby="search-patient-heading">
            <div class="card-header">
              <h2 id="search-patient-heading" class="card-title">
                <i class="fas fa-search" aria-hidden="true"></i> Rechercher un Patient
              </h2>
              <div class="card-actions" aria-hidden="true">
                <i class="fas fa-users"></i>
              </div>
            </div>
            <div class="card-body">
              <form id="searchForm" class="search-bar">
                <div class="search-input-group">
                  <input
                    id="getCin"
                    type="text"
                    placeholder="Entrer le CIN du patient"
                    aria-label="Numéro CIN du patient"
                    pattern="^[A-Za-z]{1,2}\d{5,6}$"
                  />
                  <button type="submit" id="searchBtn" class="btn btn-primary">
                    <i class="fas fa-search" aria-hidden="true"></i> Rechercher & Démarrer Visite
                  </button>
                </div>
              </form>
              <div
                id="getResult"
                role="region"
                aria-live="polite"
                class="search-results"
              ></div>
            </div>
          </section>

          <!-- Recent Patients Section -->
          <section class="card" aria-labelledby="recent-patients-heading">
            <div class="card-header">
              <h2 id="recent-patients-heading" class="card-title">
                <i class="fas fa-clock" aria-hidden="true"></i> Patients Récents
              </h2>
              <div class="card-actions" aria-hidden="true">
                <i class="fas fa-history"></i>
              </div>
            </div>
            <div class="card-body">
              <div id="recentPatientsList" class="recent-patients-list">
                <!-- Content populated by JS -->
                <p class="no-data-message">Aucun patient récent à afficher</p>
              </div>
            </div>
          </section>
        </div>
      </main>

      <footer class="footer no-print">
        <p>&copy; 2025 MediClinic. Tous droits réservés.</p>
      </footer>

      <div id="toast" class="toast" role="alert" aria-live="assertive"></div>
    </div>

    <!-- Modal for advanced patient information -->
    <div
      id="patientModal"
      class="modal"
      aria-labelledby="modal-title"
      aria-modal="true"
      role="dialog"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">Détails du Patient</h3>
          <button id="closeModal" class="close-button" aria-label="Fermer">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="patientDetails"></div>
        </div>
        <div class="modal-footer">
          <button id="startVisitBtn" class="btn btn-primary">
            Démarrer Visite
          </button>
          <button id="editPatientBtn" class="btn btn-secondary">
            Modifier
          </button>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>
    <!-- Local JS -->
    <script src="script.js" defer></script>
  </body>
</html>
